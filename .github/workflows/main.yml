name: build-push

on:
  workflow_dispatch:
  push:
    branches:
      - 'master'
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.1.0
      - name: Printing
        run: |
          response=$(curl -L -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" -H "X-GitHub-Api-Version: 2022-11-28" https://api.github.com/repos/jaklau/portfolio/commits/${{ github.sha }})
          
          key=$(jq -r '.sha' <<< "$response")
          
          key=$(echo {\"sha\": \"$key\"})
          
          data=$(echo {\"records\": [{\"key\": "$key",\"value\": "$response"}]} )
          
          echo --header "Content-Type: application/vnd.kafka.json.v2+json" --data "$data" http://nl-srv-redpanda1.hostinger.io:8082/topics/data_github_merges_0